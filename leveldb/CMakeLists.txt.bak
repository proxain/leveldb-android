cmake_minimum_required(VERSION 3.4.1)

include(TestBigEndian)
test_big_endian(LEVELDB_IS_BIG_ENDIAN)

set(LEVELDB "src/main/cpp/leveldb")

file(GLOB list src/main/cpp/jni/*.cc)

file(GLOB leveldb
    ${LEVELDB}/db/builder.cc
    ${LEVELDB}/db/c.cc
    ${LEVELDB}/db/db_impl.cc
    ${LEVELDB}/db/db_iter.cc
    ${LEVELDB}/db/dbformat.cc
    ${LEVELDB}/db/filename.cc
    ${LEVELDB}/db/log_reader.cc
    ${LEVELDB}/db/log_writer.cc
    ${LEVELDB}/db/memtable.cc
    ${LEVELDB}/db/repair.cc
    ${LEVELDB}/db/table_cache.cc
    ${LEVELDB}/db/version_edit.cc
    ${LEVELDB}/db/version_set.cc
    ${LEVELDB}/db/write_batch.cc
    ${LEVELDB}/table/block.cc
    ${LEVELDB}/table/block_builder.cc
    ${LEVELDB}/table/filter_block.cc
    ${LEVELDB}/table/format.cc
    ${LEVELDB}/table/iterator.cc
    ${LEVELDB}/table/merger.cc
    ${LEVELDB}/table/table.cc
    ${LEVELDB}/table/table_builder.cc
    ${LEVELDB}/table/two_level_iterator.cc
    ${LEVELDB}/util/arena.cc
    ${LEVELDB}/util/bloom.cc
    ${LEVELDB}/util/cache.cc
    ${LEVELDB}/util/coding.cc
    ${LEVELDB}/util/comparator.cc
    ${LEVELDB}/util/crc32c.cc
    ${LEVELDB}/util/env.cc
    ${LEVELDB}/util/env_posix.cc
    ${LEVELDB}/util/filter_policy.cc
    ${LEVELDB}/util/hash.cc
    ${LEVELDB}/util/histogram.cc
    ${LEVELDB}/util/logging.cc
    ${LEVELDB}/util/options.cc
    ${LEVELDB}/util/status.cc
)

SET( CMAKE_CXX_FLAGS                 "-std=c++11 -fexceptions -frtti -DOS_ANDROID -DLEVELDB_PLATFORM_POSIX")
SET( CMAKE_CXX_FLAGS_RELWITHDEBINFO  "-std=c++11 -fexceptions -frtti -DOS_ANDROID -DLEVELDB_PLATFORM_POSIX")
SET( CMAKE_CXX_FLAGS_RELEASE         "-std=c++11 -fexceptions -frtti -DOS_ANDROID -DLEVELDB_PLATFORM_POSIX")
SET( CMAKE_CXX_FLAGS_DEBUG           "-std=c++11 -fexceptions -frtti -DOS_ANDROID -DLEVELDB_PLATFORM_POSIX")

add_library(leveldb-android SHARED
    ${list}
    ${leveldb}
)

include_directories(${LEVELDB} ${LEVELDB}/include ${LEVELDB}/port)
include_directories(src/main/cpp)

target_link_libraries(leveldb-android
                        android
                        log)